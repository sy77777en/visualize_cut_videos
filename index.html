<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shot Transition Debugger</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        video { background: #1a1a1a; border-radius: 8px; width: 100%; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        .img-card:hover { transform: scale(1.05); transition: transform 0.2s; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-20">
    <div id="app" class="max-w-7xl mx-auto px-4 py-8">
        <header class="flex flex-col md:flex-row justify-between items-center mb-10 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 gap-4">
            <div>
                <h1 class="text-2xl font-bold text-slate-800">üé• Batch Shot Analysis</h1>
                <p class="text-slate-500 text-sm">Hugging Face Dataset: syCen/visualize_cut</p>
            </div>
            
            <div class="flex items-center gap-4 bg-slate-100 p-2 rounded-lg">
                <button @click="prevPage" :disabled="currentPage === 1" class="px-4 py-2 bg-white rounded-md shadow-sm disabled:opacity-50 hover:bg-blue-50 hover:text-blue-600 transition-all font-medium">‚Üê Prev</button>
                <span class="text-slate-600 font-mono font-bold px-2">{{ currentPage }} / {{ totalPages }}</span>
                <button @click="nextPage" :disabled="currentPage === totalPages" class="px-4 py-2 bg-white rounded-md shadow-sm disabled:opacity-50 hover:bg-blue-50 hover:text-blue-600 transition-all font-medium">Next ‚Üí</button>
            </div>
        </header>

        <div v-if="loading" class="flex flex-col items-center justify-center py-40">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
            <p class="text-slate-500">Loading Manifest from Hugging Face...</p>
        </div>

        <div v-else class="space-y-16">
            <div v-for="(data, videoKey) in paginatedVideos" :key="videoKey" class="group">
                <div class="flex items-center gap-3 mb-6">
                    <div class="h-8 w-1 bg-blue-500 rounded-full"></div>
                    <h2 class="text-xl font-bold text-slate-800 tracking-tight">{{ videoKey }}</h2>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <div class="lg:col-span-5">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3">Master Clip</p>
                        <video controls preload="metadata" :src="getHFUrl(videoKey, 'original.mp4')"></video>
                    </div>

                    <div class="lg:col-span-7 space-y-6">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3">Refined Segments & Evidence</p>
                        
                        <div v-for="(segName, index) in data.segments" :key="segName" class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm hover:border-blue-200 transition-colors">
                            <div class="flex flex-col md:flex-row gap-6">
                                <div class="md:w-1/2">
                                    <div class="text-[10px] bg-slate-100 text-slate-600 px-2 py-1 rounded w-fit mb-2 font-mono">{{ segName }}</div>
                                    <video controls preload="metadata" :src="getHFUrl(videoKey, segName)"></video>
                                </div>
                                
                                <div class="md:w-1/2" v-if="data.refined_cuts && data.refined_cuts[index]">
                                    <p class="text-sm font-semibold text-slate-700 mb-3 flex items-center gap-2">
                                        <span class="text-blue-500">üîç</span> Transition Frame: {{ data.refined_cuts[index] }}
                                    </p>
                                    <div class="grid grid-cols-5 gap-1.5">
                                        <div v-for="off in [-2, -1, 0, 1, 2]" :key="off" class="img-card text-center">
                                            <img :src="getHFUrl(videoKey, `cut_${data.refined_cuts[index]}_offset_${off}.jpg`)" 
                                                 class="rounded-md border border-slate-100 shadow-sm mb-1 object-cover aspect-video"
                                                 loading="lazy"
                                                 @error="onImgError">
                                            <span class="text-[9px] font-mono text-slate-400">f{{data.refined_cuts[index] + off}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="mt-16 border-slate-200">
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        // --- Configuration ---
        // Ê≥®ÊÑèÔºöËøôÈáåÂéªÊéâ‰∫Ü upload/mainÔºåÁõ¥Êé•‰ΩøÁî®Êï∞ÊçÆÈõÜÁöÑÊ†πÁõÆÂΩï
        const HF_BASE = "https://huggingface.co/datasets/syCen/visualize_cut/resolve/main/processed_results/";
        const VIDEOS_PER_PAGE = 5;

        createApp({
            setup() {
                const manifest = ref({});
                const loading = ref(true);
                const currentPage = ref(1);

                const getHFUrl = (videoKey, fileName) => `${HF_BASE}${videoKey}/${fileName}`;

                onMounted(async () => {
                    try {
                        // Á°Æ‰øù manifest.json Âú®Ê†πÁõÆÂΩïÊàñËÄÖÂØπÂ∫îÁöÑÊñá‰ª∂Â§πÂÜÖ
                        const response = await fetch(HF_BASE + 'manifest.json');
                        if (!response.ok) throw new Error("Manifest not found");
                        manifest.value = await response.json();
                    } catch (e) {
                        console.error(e);
                        alert("Êó†Ê≥ïÂä†ËΩΩ manifest.jsonÔºåËØ∑Ê£ÄÊü• Hugging Face ‰ªìÂ∫ìÊòØÂê¶ËÆæ‰∏∫ PublicÔºåÊàñËÄÖÊñá‰ª∂Ë∑ØÂæÑÊòØÂê¶Ê≠£Á°Æ„ÄÇ");
                    } finally {
                        loading.value = false;
                    }
                });

                const videoKeys = computed(() => Object.keys(manifest.value));
                const totalPages = computed(() => Math.ceil(videoKeys.value.length / VIDEOS_PER_PAGE));
                
                const paginatedVideos = computed(() => {
                    const start = (currentPage.value - 1) * VIDEOS_PER_PAGE;
                    const end = start + VIDEOS_PER_PAGE;
                    const keys = videoKeys.value.slice(start, end);
                    const result = {};
                    keys.forEach(k => result[k] = manifest.value[k]);
                    return result;
                });

                const nextPage = () => { if(currentPage.value < totalPages.value) currentPage.value++; window.scrollTo(0,0); };
                const prevPage = () => { if(currentPage.value > 1) currentPage.value--; window.scrollTo(0,0); };
                const onImgError = (e) => { e.target.parentElement.style.opacity = '0.3'; };

                return { loading, currentPage, totalPages, paginatedVideos, getHFUrl, nextPage, prevPage, onImgError };
            }
        }).mount('#app');
    </script>
</body>
</html>
